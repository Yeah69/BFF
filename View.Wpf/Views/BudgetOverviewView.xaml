<UserControl x:Class="BFF.View.Wpf.Views.BudgetOverviewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:forModels="clr-namespace:BFF.ViewModel.ViewModels.ForModels;assembly=BFF.ViewModel"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:utility="clr-namespace:BFF.ViewModel.ViewModels.ForModels.Utility;assembly=BFF.ViewModel"
             xmlns:viewModels="clr-namespace:BFF.ViewModel.ViewModels;assembly=BFF.ViewModel"
             xmlns:helper="clr-namespace:BFF.View.Wpf.Helper"
             xmlns:attachedBehaviors="clr-namespace:BFF.View.Wpf.AttachedBehaviors"
             x:Name="Root"
             d:DataContext="{d:DesignInstance Type=viewModels:IBudgetOverviewViewModel}"
             d:DesignHeight="300"
             d:DesignWidth="300"
             mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.DataGrid.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.CheckBox.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.ComboBox.xaml" />
                <ResourceDictionary Source="/BFF.View.Wpf;component/Resources/TransCellTemplates.xaml" />
                <ResourceDictionary Source="/BFF.View.Wpf;component/Resources/TransDataGridResources.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <Style BasedOn="{StaticResource {x:Type ListBoxItem}}"
                   TargetType="{x:Type ListBoxItem}">
                <Style.Triggers>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                        <Setter Property="Background" Value="{DynamicResource MahApps.Brushes.ThemeBackground}" />
                    </Trigger>
                    <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                        <Setter Property="Background" Value="{DynamicResource AlternatingRowBrush}" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="NonEditableBudgetEntryCell"
                   BasedOn="{StaticResource {x:Type TextBlock}}"
                   TargetType="{x:Type TextBlock}">
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="Text" Value="{Binding Converter={x:Static helper:Converters.SumToString}}" />
                <Setter Property="TextAlignment" Value="Right" />
                <Setter Property="Foreground" Value="{Binding Converter={x:Static helper:Converters.SumToSolidColorBrush}}" />
                <Style.Triggers>
                    <DataTrigger Binding="{Binding}"
                                 Value="0">
                        <Setter Property="Foreground" Value="{DynamicResource OpaqueZeroBrush}" />
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <DataTemplate x:Key="AssociatedElementsDataGrid"
                          DataType="{x:Type utility:ILazyTransLikeViewModels}">
                <Border Style="{StaticResource PopupBorder}">
                    <DataGrid Margin="2.5"
                              HorizontalScrollBarVisibility="Disabled"
                              ItemsSource="{Binding LazyElements}"
                              RowStyle="{StaticResource DefaultRowStyle}"
                              ScrollViewer.IsDeferredScrollingEnabled="True"
                              SelectionMode="Single"
                              SelectionUnit="FullRow">
                        <DataGrid.Resources />
                        <DataGrid.Columns>
                            <!--  Symbol  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource SymbolColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_SymbolAbbr, Mode=OneWay, Source={StaticResource TextsHolder}}">
                                <DataGridTemplateColumn.HeaderTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"
                                                   ToolTip="{Binding Value.CurrentTexts.AccountView_Header_SymbolAbbr_Tooltip, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.HeaderTemplate>
                            </DataGridTemplateColumn>
                            <!--  Account  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource AccountColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Account, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Account.Name" />
                            <!--  Date  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource DateColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Date, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Date" />
                            <!--  Flag  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource FlagColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Flag, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Flag.Name"
                                                    Visibility="{Binding DataContext.TransDataGridColumnManager.ShowFlags.Value, Source={x:Reference Root}, Converter={x:Static helper:Converters.FalseToCollapsed}}" />
                            <!--  CheckNumber  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource CheckNumberColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_CheckNumber, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="CheckNumber"
                                                    Visibility="{Binding DataContext.TransDataGridColumnManager.ShowCheckNumbers.Value, Source={x:Reference Root}, Converter={x:Static helper:Converters.FalseToCollapsed}}" />
                            <!--  Payee  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource PayeeColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Payee, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Payee.Name" />
                            <!--  Category  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource CategoryColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Category, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Category.Name" />
                            <!--  Memo  -->
                            <DataGridTemplateColumn Width="*"
                                                    CellTemplate="{StaticResource MemoColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Memo, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    SortMemberPath="Memo" />
                            <!--  Sum  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource SumColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Sum, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    IsReadOnly="False"
                                                    SortMemberPath="Sum" />
                            <!--  Cleared  -->
                            <DataGridTemplateColumn CellTemplate="{StaticResource ClearedColumnTemplate}"
                                                    Header="{Binding Value.CurrentTexts.AccountView_Header_Cleared, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                    IsReadOnly="True"
                                                    SortMemberPath="Cleared" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </DataTemplate>

            <helper:BindingProxy x:Key="ShowAggregatesProxy"
                                 Data="{Binding Table.ShowAggregates, Mode=TwoWay}" />
        </ResourceDictionary>
    </UserControl.Resources>
    <DockPanel>
        <DataGrid DockPanel.Dock="Bottom"
                  CanUserReorderColumns="False"
                  CanUserResizeColumns="False"
                  CanUserSortColumns="False"
                  ItemsSource="{Binding Table.Rows}">
            <i:Interaction.Behaviors>
                <attachedBehaviors:DynamicTableDataGridBehavior ColumnCount="{Binding Table.ColumnCount}"
                                                                RowHeaderTemplate="{StaticResource IndentedCategoryItemTemplate}"
                                                                Table="{Binding Table}">
                    <attachedBehaviors:DynamicTableDataGridBehavior.CellTemplate>
                        <DataTemplate>
                            <Border HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    BorderBrush="{StaticResource MahApps.Brushes.Accent}"
                                    BorderThickness="2,0,0,0">
                                <ContentControl Content="{Binding}">
                                    <ContentControl.Resources>
                                        <DataTemplate DataType="{x:Type forModels:BudgetEntryViewModel}">
                                            <UniformGrid Columns="3">
                                                <ContentControl Content="{Binding}">
                                                    <ContentControl.Style>
                                                        <Style TargetType="{x:Type ContentControl}">
                                                            <Setter Property="ContentTemplate">
                                                                <Setter.Value>
                                                                    <DataTemplate>
                                                                        <Grid Background="Transparent">

                                                                            <TextBox Height="25"
                                                                                     MinHeight="25"
                                                                                     HorizontalContentAlignment="Right"
                                                                                     attachedBehaviors:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="TextBox.Text"
                                                                                     Text="{Binding Budget, Converter={x:Static helper:Converters.SumToString}}"
                                                                                     TextAlignment="Right">
                                                                                <TextBox.Style>
                                                                                    <Style BasedOn="{StaticResource {x:Type TextBox}}"
                                                                                           TargetType="{x:Type TextBox}">
                                                                                        <Style.Triggers>
                                                                                            <Trigger Property="IsReadOnly" Value="True">
                                                                                                <Setter Property="BorderBrush" Value="Transparent" />
                                                                                                <Setter Property="Background" Value="Transparent" />
                                                                                            </Trigger>
                                                                                            <Trigger Property="IsFocused" Value="True">
                                                                                                <Setter Property="IsReadOnly" Value="False" />
                                                                                            </Trigger>
                                                                                            <DataTrigger Binding="{Binding Budget}"
                                                                                                         Value="0">
                                                                                                <Setter Property="Foreground" Value="{DynamicResource OpaqueZeroBrush}" />
                                                                                            </DataTrigger>
                                                                                        </Style.Triggers>
                                                                                        <Setter Property="IsReadOnly" Value="True" />
                                                                                        <Setter Property="Foreground" Value="{Binding Budget, Converter={x:Static helper:Converters.SumToSolidColorBrush}}" />
                                                                                    </Style>
                                                                                </TextBox.Style>
                                                                            </TextBox>
                                                                            <iconPacks:PackIconMaterial Width="{StaticResource IconSize}"
                                                                                                        Height="{StaticResource IconSize}"
                                                                                                        Margin="0"
                                                                                                        Padding="0"
                                                                                                        HorizontalAlignment="Left"
                                                                                                        VerticalAlignment="Center"
                                                                                                        Background="Transparent"
                                                                                                        Foreground="{DynamicResource MahApps.Brushes.Accent}"
                                                                                                        Kind="DotsHorizontal">
                                                                                <i:Interaction.Behaviors>
                                                                                    <attachedBehaviors:FrameworkElementClickBehavior Click="BudgetEntryMenu_OnClick" />
                                                                                </i:Interaction.Behaviors>
                                                                                <iconPacks:PackIconMaterial.ContextMenu>
                                                                                    <ContextMenu Placement="Bottom">
                                                                                        <MenuItem Command="{Binding BudgetLastMonth}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.BudgetLastMonth, Source={x:Reference Root}}" />
                                                                                        <MenuItem Command="{Binding OutflowsLastMonth}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.OutflowsLastMonth, Source={x:Reference Root}}" />
                                                                                        <MenuItem Command="{Binding AvgOutflowsLastThreeMonths}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.AvgOutflowLastThreeMonths, Source={x:Reference Root}}" />
                                                                                        <MenuItem Command="{Binding AvgOutflowsLastYear}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.AvgOutflowsLastYear, Source={x:Reference Root}}" />
                                                                                        <MenuItem Command="{Binding BalanceToZero}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.BalanceToZero, Source={x:Reference Root}}" />
                                                                                        <MenuItem Command="{Binding Zero}"
                                                                                                  Header="{Binding DataContext.BudgetMonthMenuTitles.Zero, Source={x:Reference Root}}" />
                                                                                    </ContextMenu>
                                                                                </iconPacks:PackIconMaterial.ContextMenu>
                                                                                <iconPacks:PackIconMaterial.Style>
                                                                                    <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                                                        <Style.Triggers>
                                                                                            <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                                                                                                         Value="True">
                                                                                                <Setter Property="Visibility" Value="Visible" />
                                                                                            </DataTrigger>
                                                                                            <DataTrigger Binding="{Binding ContextMenu.IsOpen, RelativeSource={RelativeSource Self}}"
                                                                                                         Value="True">
                                                                                                <Setter Property="Visibility" Value="Visible" />
                                                                                            </DataTrigger>
                                                                                        </Style.Triggers>
                                                                                    </Style>
                                                                                </iconPacks:PackIconMaterial.Style>
                                                                            </iconPacks:PackIconMaterial>
                                                                        </Grid>
                                                                    </DataTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Data, Source={StaticResource ShowAggregatesProxy}}"
                                                                             Value="True">
                                                                    <Setter Property="ContentTemplate">
                                                                        <Setter.Value>
                                                                            <DataTemplate>
                                                                                <TextBlock DataContext="{Binding AggregatedBudget}"
                                                                                           Style="{StaticResource NonEditableBudgetEntryCell}" />
                                                                            </DataTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ContentControl.Style>
                                                </ContentControl>
                                                <Grid Background="Transparent"
                                                      Tag="{Binding}">
                                                    <i:Interaction.Behaviors>
                                                        <attachedBehaviors:FrameworkElementClickBehavior Click="OutflowCell_OnClick" />
                                                    </i:Interaction.Behaviors>

                                                    <ContentControl Content="{Binding}">
                                                        <ContentControl.Style>
                                                            <Style TargetType="{x:Type ContentControl}">
                                                                <Setter Property="ContentTemplate">
                                                                    <Setter.Value>
                                                                        <DataTemplate>
                                                                            <TextBlock DataContext="{Binding Outflow}"
                                                                                       Style="{StaticResource NonEditableBudgetEntryCell}" />
                                                                        </DataTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Data, Source={StaticResource ShowAggregatesProxy}}"
                                                                                 Value="True">
                                                                        <Setter Property="ContentTemplate">
                                                                            <Setter.Value>
                                                                                <DataTemplate>
                                                                                    <TextBlock DataContext="{Binding AggregatedOutflow}"
                                                                                               Style="{StaticResource NonEditableBudgetEntryCell}" />
                                                                                </DataTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </ContentControl.Style>
                                                    </ContentControl>


                                                    <Popup Width="1000"
                                                           MaxHeight="500"
                                                           d:DataContext="{d:DesignInstance Type=forModels:IBudgetEntryViewModel}"
                                                           DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"
                                                           IsOpen="{Binding AssociatedTransElementsViewModel.OpenFlag}"
                                                           PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                                                           StaysOpen="False">
                                                        <Popup.Style>
                                                            <Style TargetType="{x:Type Popup}">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsOpen" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Popup.Style>
                                                        <i:Interaction.Behaviors>
                                                            <attachedBehaviors:PopupCommands ClosedCommand="{Binding AssociatedTransElementsViewModel.ClearLazyElements}"
                                                                                             OpenedCommand="{Binding AssociatedTransElementsViewModel.LoadLazyElements}" />
                                                        </i:Interaction.Behaviors>
                                                        <ContentControl Content="{Binding AssociatedTransElementsViewModel}">
                                                            <ContentControl.Style>
                                                                <Style TargetType="{x:Type ContentControl}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsOpen, RelativeSource={RelativeSource AncestorType={x:Type Popup}}}"
                                                                                     Value="True">
                                                                            <Setter Property="ContentTemplate" Value="{StaticResource AssociatedElementsDataGrid}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                    <Setter Property="ContentTemplate" Value="{StaticResource EmptyDataTemplate}" />
                                                                </Style>
                                                            </ContentControl.Style>
                                                        </ContentControl>
                                                    </Popup>

                                                    <Popup Width="1000"
                                                           MaxHeight="500"
                                                           d:DataContext="{d:DesignInstance Type=forModels:IBudgetEntryViewModel}"
                                                           DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"
                                                           IsOpen="{Binding AssociatedAggregatedTransElementsViewModel.OpenFlag}"
                                                           PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                                                           StaysOpen="False">
                                                        <Popup.Style>
                                                            <Style TargetType="{x:Type Popup}">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <Trigger Property="IsOpen" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </Trigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Popup.Style>
                                                        <i:Interaction.Behaviors>
                                                            <attachedBehaviors:PopupCommands ClosedCommand="{Binding AssociatedAggregatedTransElementsViewModel.ClearLazyElements}"
                                                                                             OpenedCommand="{Binding AssociatedAggregatedTransElementsViewModel.LoadLazyElements}" />
                                                        </i:Interaction.Behaviors>
                                                        <ContentControl Content="{Binding AssociatedAggregatedTransElementsViewModel}">
                                                            <ContentControl.Style>
                                                                <Style TargetType="{x:Type ContentControl}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsOpen, RelativeSource={RelativeSource AncestorType={x:Type Popup}}}"
                                                                                     Value="True">
                                                                            <Setter Property="ContentTemplate" Value="{StaticResource AssociatedElementsDataGrid}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                    <Setter Property="ContentTemplate" Value="{StaticResource EmptyDataTemplate}" />
                                                                </Style>
                                                            </ContentControl.Style>
                                                        </ContentControl>
                                                    </Popup>
                                                </Grid>

                                                <ContentControl Content="{Binding}">
                                                    <ContentControl.Style>
                                                        <Style TargetType="{x:Type ContentControl}">
                                                            <Setter Property="ContentTemplate">
                                                                <Setter.Value>
                                                                    <DataTemplate>
                                                                        <TextBlock DataContext="{Binding Balance}"
                                                                                   Style="{StaticResource NonEditableBudgetEntryCell}" />
                                                                    </DataTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Data, Source={StaticResource ShowAggregatesProxy}}"
                                                                             Value="True">
                                                                    <Setter Property="ContentTemplate">
                                                                        <Setter.Value>
                                                                            <DataTemplate>
                                                                                <TextBlock DataContext="{Binding AggregatedBalance}"
                                                                                           Style="{StaticResource NonEditableBudgetEntryCell}" />
                                                                            </DataTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ContentControl.Style>
                                                </ContentControl>
                                            </UniformGrid>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type forModels:BudgetEntryViewModelPlaceholder}" />
                                    </ContentControl.Resources>
                                </ContentControl>
                            </Border>
                        </DataTemplate>
                    </attachedBehaviors:DynamicTableDataGridBehavior.CellTemplate>
                    <attachedBehaviors:DynamicTableDataGridBehavior.ColumnHeaderTemplate>
                        <DataTemplate>
                            <Border Margin="-10,0,0,0"
                                    HorizontalAlignment="Stretch"
                                    VerticalAlignment="Stretch"
                                    BorderBrush="{StaticResource MahApps.Brushes.Accent}"
                                    BorderThickness="2,0,0,0">
                                <ContentControl Content="{Binding}">
                                    <ContentControl.Resources>
                                        <DataTemplate DataType="{x:Type viewModels:BudgetMonthViewModel}">
                                            <DockPanel x:Name="MonthHeader" HorizontalAlignment="Stretch"
                                                       Background="{StaticResource MahApps.Brushes.ThemeBackground}"
                                                       LastChildFill="True">
                                                <UniformGrid HorizontalAlignment="Stretch"
                                                             d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                             Columns="3"
                                                             DockPanel.Dock="Bottom"
                                                             Rows="2">
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Budgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Outflows, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Balance, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Foreground="{Binding BudgetedThisMonthPositive, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                               Text="{Binding BudgetedThisMonthPositive, Converter={x:Static helper:Converters.SumToString}}"
                                                               TextAlignment="Right" />
                                                    <Grid Background="Transparent"
                                                          Tag="{Binding}">
                                                        <i:Interaction.Behaviors>
                                                            <attachedBehaviors:FrameworkElementClickBehavior Click="MonthOutflowCell_OnClick" />
                                                        </i:Interaction.Behaviors>

                                                        <TextBlock Foreground="{Binding Outflows, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                   Text="{Binding Outflows, Converter={x:Static helper:Converters.SumToString}}"
                                                                   TextAlignment="Right" />

                                                        <Popup Width="1000"
                                                               MaxHeight="500"
                                                               d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                               DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"
                                                               IsOpen="{Binding AssociatedTransElementsViewModel.OpenFlag}"
                                                               PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                                                               StaysOpen="False">
                                                            <i:Interaction.Behaviors>
                                                                <attachedBehaviors:PopupCommands ClosedCommand="{Binding AssociatedTransElementsViewModel.ClearLazyElements}"
                                                                                                 OpenedCommand="{Binding AssociatedTransElementsViewModel.LoadLazyElements}" />
                                                            </i:Interaction.Behaviors>
                                                            <ContentControl Content="{Binding AssociatedTransElementsViewModel}">
                                                                <ContentControl.Style>
                                                                    <Style TargetType="{x:Type ContentControl}">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsOpen, RelativeSource={RelativeSource AncestorType={x:Type Popup}}}"
                                                                                         Value="True">
                                                                                <Setter Property="ContentTemplate" Value="{StaticResource AssociatedElementsDataGrid}" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                        <Setter Property="ContentTemplate" Value="{StaticResource EmptyDataTemplate}" />
                                                                    </Style>
                                                                </ContentControl.Style>
                                                            </ContentControl>
                                                        </Popup>
                                                    </Grid>
                                                    <TextBlock Foreground="{Binding Balance, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                               Text="{Binding Balance, Converter={x:Static helper:Converters.SumToString}}"
                                                               TextAlignment="Right" />
                                                </UniformGrid>
                                                <Grid HorizontalAlignment="Stretch"
                                                      d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                      DockPanel.Dock="Top">
                                                    <iconPacks:PackIconMaterial Width="{StaticResource IconSize}"
                                                                                Height="{StaticResource IconSize}"
                                                                                Margin="5"
                                                                                HorizontalAlignment="Right"
                                                                                VerticalAlignment="Top"
                                                                                Background="Transparent"
                                                                                Foreground="{DynamicResource MahApps.Brushes.Accent}"
                                                                                Kind="DotsVertical">
                                                        <i:Interaction.Behaviors>
                                                            <attachedBehaviors:FrameworkElementClickBehavior Click="MonthDataHeaderMenu_OnClick" />
                                                        </i:Interaction.Behaviors>
                                                        <iconPacks:PackIconMaterial.ContextMenu>
                                                            <ContextMenu Placement="Bottom">
                                                                <MenuItem Header="{Binding DataContext.BudgetMonthMenuTitles.EmptyCellsHeader, Source={x:Reference Root}}">
                                                                    <MenuItem Command="{Binding EmptyCellsBudgetLastMonth}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.BudgetLastMonth, Source={x:Reference Root}}" />
                                                                    <MenuItem Command="{Binding EmptyCellsOutflowsLastMonth}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.OutflowsLastMonth, Source={x:Reference Root}}" />
                                                                    <MenuItem Command="{Binding EmptyCellsAvgOutflowsLastThreeMonths}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.AvgOutflowLastThreeMonths, Source={x:Reference Root}}" />
                                                                    <MenuItem Command="{Binding EmptyCellsAvgOutflowsLastYear}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.AvgOutflowsLastYear, Source={x:Reference Root}}" />
                                                                    <MenuItem Command="{Binding EmptyCellsBalanceToZero}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.BalanceToZero, Source={x:Reference Root}}" />
                                                                </MenuItem>
                                                                <MenuItem Header="{Binding DataContext.BudgetMonthMenuTitles.AllCellsHeader, Source={x:Reference Root}}">
                                                                    <MenuItem Command="{Binding AllCellsZero}"
                                                                              Header="{Binding DataContext.BudgetMonthMenuTitles.Zero, Source={x:Reference Root}}" />
                                                                </MenuItem>
                                                            </ContextMenu>
                                                        </iconPacks:PackIconMaterial.ContextMenu>
                                                        <iconPacks:PackIconMaterial.Style>
                                                            <Style TargetType="{x:Type iconPacks:PackIconMaterial}">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type Border}}}"
                                                                                 Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding ContextMenu.IsOpen, RelativeSource={RelativeSource Self}}"
                                                                                 Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </iconPacks:PackIconMaterial.Style>
                                                    </iconPacks:PackIconMaterial>
                                                    <StackPanel>
                                                        <StackPanel.Resources>
                                                            <Style x:Key="CurrentMonthMarking"
                                                                   BasedOn="{StaticResource {x:Type TextBlock}}"
                                                                   TargetType="{x:Type TextBlock}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Month, Converter={x:Static helper:Converters.IsCurrentMonth}}"
                                                                                 Value="True">
                                                                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                                <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                                                            </Style>
                                                        </StackPanel.Resources>
                                                        <TextBlock Margin="0,0,0,5"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="10"
                                                                   Style="{StaticResource CurrentMonthMarking}"
                                                                   Text="{Binding Month, StringFormat=yyyy}" />
                                                        <TextBlock Margin="0,0,0,5"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="25"
                                                                   Style="{StaticResource CurrentMonthMarking}"
                                                                   Text="{Binding MonthName}" />
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                            </Grid.RowDefinitions>
                                                            <ContentControl Grid.Row="0"
                                                                            Grid.Column="0"
                                                                            Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}">
                                                                <ContentControl.Style>
                                                                    <Style TargetType="{x:Type ContentControl}">
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding NotBudgetedInPreviousMonth, Converter={x:Static helper:Converters.LongLesserThanZero}}"
                                                                                         Value="True">
                                                                                <Setter Property="ContentTemplate">
                                                                                    <Setter.Value>
                                                                                        <DataTemplate>
                                                                                            <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Overbudgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_OverbudgetedExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                                                        </DataTemplate>
                                                                                    </Setter.Value>
                                                                                </Setter>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                        <Setter Property="ContentTemplate">
                                                                            <Setter.Value>
                                                                                <DataTemplate>
                                                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_NotBudgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                                               ToolTip="{Binding Value.CurrentTexts.Budgeting_NotBudgetedExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                                                </DataTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </ContentControl.Style>
                                                            </ContentControl>
                                                            <TextBlock Grid.Row="0"
                                                                       Grid.Column="1"
                                                                       Foreground="{Binding NotBudgetedInPreviousMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                       Text="{Binding NotBudgetedInPreviousMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                       TextAlignment="Right" />
                                                            <TextBlock Grid.Row="1"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Overspend, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_OverspendExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="1"
                                                                       Grid.Column="1"
                                                                       Foreground="{Binding OverspentInPreviousMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                       Text="{Binding OverspentInPreviousMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                       TextAlignment="Right" />
                                                            <TextBlock Grid.Row="2"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Income, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_IncomeExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />

                                                            <Grid Grid.Row="2"
                                                                  Grid.Column="1"
                                                                  Background="Transparent"
                                                                  Tag="{Binding}">
                                                                <i:Interaction.Behaviors>
                                                                    <attachedBehaviors:FrameworkElementClickBehavior Click="MonthIncomeCell_OnClick" />
                                                                </i:Interaction.Behaviors>

                                                                <TextBlock Foreground="{Binding IncomeForThisMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                           Text="{Binding IncomeForThisMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                           TextAlignment="Right" />

                                                                <Popup Width="1000"
                                                                       MaxHeight="500"
                                                                       d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                                       DataContext="{Binding PlacementTarget.Tag, RelativeSource={RelativeSource Self}}"
                                                                       IsOpen="{Binding AssociatedIncomeTransElementsViewModel.OpenFlag}"
                                                                       PlacementTarget="{Binding RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                                                                       StaysOpen="False">
                                                                    <i:Interaction.Behaviors>
                                                                        <attachedBehaviors:PopupCommands ClosedCommand="{Binding AssociatedIncomeTransElementsViewModel.ClearLazyElements}"
                                                                                                         OpenedCommand="{Binding AssociatedIncomeTransElementsViewModel.LoadLazyElements}" />
                                                                    </i:Interaction.Behaviors>
                                                                    <ContentControl Content="{Binding AssociatedIncomeTransElementsViewModel}">
                                                                        <ContentControl.Style>
                                                                            <Style TargetType="{x:Type ContentControl}">
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsOpen, RelativeSource={RelativeSource AncestorType={x:Type Popup}}}"
                                                                                                 Value="True">
                                                                                        <Setter Property="ContentTemplate" Value="{StaticResource AssociatedElementsDataGrid}" />
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                                <Setter Property="ContentTemplate" Value="{StaticResource EmptyDataTemplate}" />
                                                                            </Style>
                                                                        </ContentControl.Style>
                                                                    </ContentControl>
                                                                </Popup>
                                                            </Grid>
                                                            <TextBlock Grid.Row="3"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Budgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_BudgetedExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="3"
                                                                       Grid.Column="1"
                                                                       Foreground="{Binding BudgetedThisMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                       Text="{Binding BudgetedThisMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                       TextAlignment="Right" />
                                                            <TextBlock Grid.Row="4"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_UnassignedTransactions, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_UnassignedTransactionsExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       Visibility="{Binding UnassignedTransactionSumForThisMonth, Converter={x:Static helper:Converters.ZeroLongToHidden}}" />
                                                            <TextBlock Grid.Row="4"
                                                                       Grid.Column="1"
                                                                       Foreground="{Binding UnassignedTransactionSumForThisMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                       Text="{Binding UnassignedTransactionSumForThisMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                       TextAlignment="Right"
                                                                       Visibility="{Binding UnassignedTransactionSumForThisMonth, Converter={x:Static helper:Converters.ZeroLongToHidden}}" />
                                                            <TextBlock Grid.Row="5"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_OneSidedTransfers, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_OneSidedTransfersExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       Visibility="{Binding DanglingTransferForThisMonth, Converter={x:Static helper:Converters.ZeroLongToHidden}}" />
                                                            <TextBlock Grid.Row="5"
                                                                       Grid.Column="1"
                                                                       Foreground="{Binding DanglingTransferForThisMonth, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                       Text="{Binding DanglingTransferForThisMonth, Converter={x:Static helper:Converters.SumToString}}"
                                                                       TextAlignment="Right"
                                                                       Visibility="{Binding DanglingTransferForThisMonth, Converter={x:Static helper:Converters.ZeroLongToHidden}}" />
                                                        </Grid>
                                                        <ContentControl Margin="0,5,0,0"
                                                                        HorizontalAlignment="Center"
                                                                        Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}">
                                                            <ContentControl.Style>
                                                                <Style TargetType="{x:Type ContentControl}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding AvailableToBudget, Converter={x:Static helper:Converters.LongLesserThanZero}}"
                                                                                     Value="True">
                                                                            <Setter Property="ContentTemplate">
                                                                                <Setter.Value>
                                                                                    <DataTemplate>
                                                                                        <TextBlock FontSize="10"
                                                                                                   Text="{Binding Value.CurrentTexts.Budgeting_Overbudgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                                                   ToolTip="{Binding Value.CurrentTexts.Budgeting_OverbudgetedThisMonthExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                                                    </DataTemplate>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                    <Setter Property="ContentTemplate">
                                                                        <Setter.Value>
                                                                            <DataTemplate>
                                                                                <TextBlock FontSize="10"
                                                                                           Text="{Binding Value.CurrentTexts.Budgeting_Available, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                                           ToolTip="{Binding Value.CurrentTexts.Budgeting_AvailableExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                                            </DataTemplate>
                                                                        </Setter.Value>
                                                                    </Setter>
                                                                </Style>
                                                            </ContentControl.Style>
                                                        </ContentControl>
                                                        <TextBlock Margin="0,5,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="25"
                                                                   Foreground="{Binding AvailableToBudget, Converter={x:Static helper:Converters.SumToSolidColorBrush}}"
                                                                   Text="{Binding AvailableToBudget, Converter={x:Static helper:Converters.SumToString}}" />
                                                    </StackPanel>
                                                </Grid>
                                            </DockPanel>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type viewModels:BudgetMonthViewModelPlaceholder}">
                                            <DockPanel HorizontalAlignment="Stretch"
                                                       LastChildFill="True">
                                                <UniformGrid HorizontalAlignment="Stretch"
                                                             d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                             Columns="3"
                                                             DockPanel.Dock="Bottom"
                                                             Rows="2">
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Budgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Outflows, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Text="{Binding Value.CurrentTexts.Budgeting_Balance, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                               TextAlignment="Left" />
                                                    <TextBlock Text="0"
                                                               TextAlignment="Right"
                                                               Visibility="Hidden" />
                                                    <TextBlock Text="0"
                                                               TextAlignment="Right"
                                                               Visibility="Hidden" />
                                                    <TextBlock Text="0"
                                                               TextAlignment="Right"
                                                               Visibility="Hidden" />
                                                </UniformGrid>
                                                <Grid HorizontalAlignment="Stretch"
                                                      d:DataContext="{d:DesignInstance viewModels:IBudgetMonthViewModel}"
                                                      DockPanel.Dock="Top">
                                                    <StackPanel>
                                                        <StackPanel.Resources>
                                                            <Style x:Key="CurrentMonthMarking"
                                                                   BasedOn="{StaticResource {x:Type TextBlock}}"
                                                                   TargetType="{x:Type TextBlock}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Month, Converter={x:Static helper:Converters.IsCurrentMonth}}"
                                                                                 Value="True">
                                                                        <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                                <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.ThemeForeground}" />
                                                            </Style>
                                                        </StackPanel.Resources>
                                                        <TextBlock Margin="0,0,0,5"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="10"
                                                                   Style="{StaticResource CurrentMonthMarking}"
                                                                   Text="{Binding Month, StringFormat=yyyy}" />
                                                        <TextBlock Margin="0,0,0,5"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="25"
                                                                   Style="{StaticResource CurrentMonthMarking}"
                                                                   Text="{Binding MonthName}" />
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                                <RowDefinition />
                                                            </Grid.RowDefinitions>

                                                            <TextBlock Grid.Row="0"
                                                                       Grid.Column="0"
                                                                       Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_NotBudgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_NotBudgetedExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="1"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Overspend, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_OverspendExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="2"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Income, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_IncomeExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="3"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_Budgeted, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_BudgetedExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                            <TextBlock Grid.Row="4"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_UnassignedTransactions, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_UnassignedTransactionsExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       Visibility="Hidden" />
                                                            <TextBlock Grid.Row="5"
                                                                       Grid.Column="0"
                                                                       Text="{Binding Value.CurrentTexts.Budgeting_OneSidedTransfers, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       ToolTip="{Binding Value.CurrentTexts.Budgeting_OneSidedTransfersExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                       Visibility="Hidden" />
                                                        </Grid>
                                                        <TextBlock Margin="0,5,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="10"
                                                                   Foreground="{DynamicResource MahApps.Brushes.ThemeForeground}"
                                                                   Text="{Binding Value.CurrentTexts.Budgeting_Available, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                                   ToolTip="{Binding Value.CurrentTexts.Budgeting_AvailableExplanation, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                                                        <TextBlock Margin="0,5,0,0"
                                                                   HorizontalAlignment="Center"
                                                                   FontSize="25"
                                                                   Text="0"
                                                                   Visibility="Hidden" />
                                                    </StackPanel>
                                                </Grid>
                                            </DockPanel>
                                        </DataTemplate>
                                    </ContentControl.Resources>
                                </ContentControl>
                            </Border>
                        </DataTemplate>
                    </attachedBehaviors:DynamicTableDataGridBehavior.ColumnHeaderTemplate>
                    <attachedBehaviors:DynamicTableDataGridBehavior.CornerHeaderTemplate>
                        <DataTemplate DataType="{x:Type viewModels:IBudgetOverviewViewModel}">
                            <DockPanel HorizontalAlignment="Stretch"
                                       VerticalAlignment="Stretch">
                                <UniformGrid Columns="2"
                                             DockPanel.Dock="Top">
                                    <ComboBox Margin="5"
                                              DisplayMemberPath="Name"
                                              ItemsSource="{Binding Table.MonthViewModels}"
                                              SelectedItem="{Binding Table.SelectedMonthViewModel}" />
                                    <mah:NumericUpDown Margin="5"
                                                       Interval="1.0"
                                                       Maximum="9999"
                                                       Minimum="1"
                                                       Value="{Binding Table.SelectedYear}" />
                                    <Button Margin="5"
                                            Command="{Binding Table.DecreaseMonthStartIndex}"
                                            DockPanel.Dock="Left"
                                            ToolTip="{Binding Value.CurrentTexts.ToolTip_BudgetOverview_ShiftMonthBackward, Mode=OneWay, Source={StaticResource TextsHolder}}">
                                        <iconPacks:PackIconModern Width="{StaticResource IconSize}"
                                                                  Height="{StaticResource IconSize}"
                                                                  Kind="ChevronLeft" />
                                    </Button>
                                    <Button Margin="5"
                                            Command="{Binding Table.IncreaseMonthStartIndex}"
                                            DockPanel.Dock="Right"
                                            ToolTip="{Binding Value.CurrentTexts.ToolTip_BudgetOverview_ShiftMonthForward, Mode=OneWay, Source={StaticResource TextsHolder}}">
                                        <iconPacks:PackIconModern Width="{StaticResource IconSize}"
                                                                  Height="{StaticResource IconSize}"
                                                                  Kind="ChevronRight" />
                                    </Button>
                                    <iconPacks:PackIconBoxIcons HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Kind="RegularColumns" />
                                    <mah:NumericUpDown Margin="5"
                                                       Maximum="{Binding Table.MaxColumnCount}"
                                                       Minimum="{Binding Table.MinColumnCount}"
                                                       Value="{Binding Table.ColumnCount}" />
                                </UniformGrid>
                                <mah:ToggleSwitch x:Name="AggregateSwitch"
                                                  VerticalAlignment="Bottom"
                                                  DockPanel.Dock="Bottom"
                                                  Header="{Binding Value.CurrentTexts.Budgeting_ShowAggregates, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                  IsOn="{Binding Data, Mode=TwoWay, Source={StaticResource ShowAggregatesProxy}}"
                                                  OffContent="{Binding Value.CurrentTexts.General_No, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                  OnContent="{Binding Value.CurrentTexts.General_Yes, Mode=OneWay, Source={StaticResource TextsHolder}}"
                                                  ToolTip="{Binding Value.CurrentTexts.ToolTip_BudgetOverview_Aggregates, Mode=OneWay, Source={StaticResource TextsHolder}}" />
                            </DockPanel>
                        </DataTemplate>
                    </attachedBehaviors:DynamicTableDataGridBehavior.CornerHeaderTemplate>
                </attachedBehaviors:DynamicTableDataGridBehavior>
            </i:Interaction.Behaviors>
            <DataGrid.ColumnHeaderStyle>
                <Style BasedOn="{StaticResource MahApps.Styles.DataGridColumnHeader}"
                       TargetType="{x:Type DataGridColumnHeader}">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    <Setter Property="VerticalContentAlignment" Value="Stretch" />
                </Style>
            </DataGrid.ColumnHeaderStyle>
        </DataGrid>
    </DockPanel>
</UserControl>