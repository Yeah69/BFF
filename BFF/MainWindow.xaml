<controls:MetroWindow x:Class="BFF.MainWindow"
        xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:BFF.WPFStuff.Converters"
        xmlns:lex="http://wpflocalizeextension.codeplex.com"
        xmlns:native="clr-namespace:BFF.Model.Native"
        xmlns:structure="clr-namespace:BFF.Model.Native.Structure"
        lex:LocalizeDictionary.DesignCulture="en"
        lex:ResxLocalizationProvider.DefaultAssembly="BFF"
        lex:ResxLocalizationProvider.DefaultDictionary="Resources"
        Title="BFF" Height="700" Width="1300" MinHeight="700" MinWidth="1300" ShowIconOnTitleBar="True" Icon="Icons/logo_quadratic.png" ResizeMode="CanResizeWithGrip" WindowButtonCommandsOverlayBehavior="Never" RightWindowCommandsOverlayBehavior="Never">
    <controls:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Icons.xaml" />
                <ResourceDictionary Source="/WPFStuff/Resources/BFF_ResourceDictionary.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:SumToBrushConverter x:Key="SumToBrush" PositiveBrush="{StaticResource BrushPositive}" NegativeBrush="{StaticResource BrushNegative}" TransferBrush="{StaticResource BrushTransfer}"/>
            <converters:SumFormatedConverter x:Key="SumFormat"/>
        </ResourceDictionary>
    </controls:MetroWindow.Resources>
    <controls:MetroWindow.Flyouts>
        <controls:FlyoutsControl>
            <controls:Flyout Name="SettingsFlyout" Header="{lex:Loc Settings}" Position="Right" Width="300">
                <Grid>
                    <StackPanel Orientation="Vertical">
                        <Label Content="{lex:Loc Theme}"/>
                        <ComboBox Name="ThemeCombo" SelectionChanged="ThemeCombo_SelectionChanged" DisplayMemberPath="Name" />
                        <Label Content="{lex:Loc Accents}"/>
                        <ComboBox Name="AccentCombo" SelectionChanged="AccentCombo_SelectionChanged" DisplayMemberPath="Name" />
                        <Label Content="{lex:Loc Language}"/>
                        <ComboBox Name="LanguageCombo" SelectionChanged="LanguageCombo_SelectionChanged"/>
                    </StackPanel>
                </Grid>
            </controls:Flyout>
        </controls:FlyoutsControl>
    </controls:MetroWindow.Flyouts>
    <controls:MetroWindow.RightWindowCommands>
        <controls:WindowCommands>
            <Button Name="SettingsButt" Content="{lex:Loc Settings}" Click="SettingsButt_Click"/>
            <Button Content="{lex:Loc About}"/>
        </controls:WindowCommands>
    </controls:MetroWindow.RightWindowCommands>
    <controls:MetroWindow.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Send" />
        </ContextMenu>
    </controls:MetroWindow.ContextMenu>
    <Grid>
        <DataGrid x:Name="DataGrid" Margin="10" ItemsSource="{Binding AllTransactions}" AutoGenerateColumns="False" AlternationCount="2">
            <DataGrid.RowStyle>
                <Style TargetType="{x:Type DataGridRow}">
                    <Style.Triggers>
                        <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                            <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}" />
                        </Trigger>
                        <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                            <Setter Property="Background" Value="{DynamicResource GrayBrush10}" />
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="true">
                            <Setter Property="Background" Value="{DynamicResource AccentColorBrush2}" />
                            <Setter Property="Foreground" Value="#000" />
                            <!-- todo: set the foreground dynamic -->
                        </Trigger>
                        <Trigger Property="IsSelected" Value="true">
                            <Setter Property="Background" Value="{DynamicResource AccentColorBrush}" />
                            <Setter Property="Foreground" Value="#000" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
            <DataGrid.Columns>
                <DataGridTemplateColumn Header="S">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Resources>
                                    <DataTemplate DataType="{x:Type native:Transaction}">
                                        <Rectangle HorizontalAlignment="Left" VerticalAlignment="Center" Height="15" Width="15" Fill="{StaticResource BrushNegative}">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Visual="{StaticResource appbar_inbox_out}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Income}">
                                        <Rectangle HorizontalAlignment="Left" VerticalAlignment="Center" Height="15" Width="15" Fill="{StaticResource BrushPositive}">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Visual="{StaticResource appbar_inbox_in}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Transfer}">
                                        <Rectangle HorizontalAlignment="Left" VerticalAlignment="Center" Height="15" Width="15" Fill="{StaticResource BrushTransfer}">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Visual="{StaticResource appbar_arrow_left_right}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>
                                    </DataTemplate>
                                </ContentControl.Resources>
                            </ContentControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{lex:Loc Account}" SortMemberPath="Account.Name">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Resources>
                                    <DataTemplate DataType="{x:Type structure:TransactionIncome}">
                                        <TextBlock Text="{Binding Account}"></TextBlock>
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Transfer}">
                                        <TextBlock Text="{lex:Loc Account_Transfer}"></TextBlock>
                                    </DataTemplate>
                                </ContentControl.Resources>
                            </ContentControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="{lex:Loc Date}" SortDirection="Ascending" Binding="{Binding Date, StringFormat=\{0:yy/MM/dd\}}"/>
                <DataGridTemplateColumn Header="{lex:Loc Payee}" SortMemberPath="Payee.Name">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Resources>
                                    <DataTemplate DataType="{x:Type structure:TransactionIncome}">
                                        <TextBlock Text="{Binding Payee}"></TextBlock>
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Transfer}">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding FromAccount}"/>
                                            <Rectangle Margin="5,0,0,0" VerticalAlignment="Center" Height="15" Width="15" Fill="{StaticResource BrushNeutral}">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Visual="{DynamicResource appbar_layout_expand_right_variant}"/>
                                                </Rectangle.OpacityMask>
                                            </Rectangle>
                                        </StackPanel>
                                    </DataTemplate>
                                </ContentControl.Resources>
                            </ContentControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{lex:Loc Category}" SortMemberPath="Category.Name">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Resources>
                                    <DataTemplate DataType="{x:Type structure:TransactionIncome}">
                                        <TextBlock Text="{Binding Category}"></TextBlock>
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Transfer}">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding ToAccount}"></TextBlock>
                                            <Rectangle Margin="5,0,0,0" VerticalAlignment="Center" Height="15" Width="15" Fill="{StaticResource BrushNeutral}">
                                                <Rectangle.OpacityMask>
                                                    <VisualBrush Visual="{DynamicResource appbar_layout_expand_right}"/>
                                                </Rectangle.OpacityMask>
                                            </Rectangle>
                                        </StackPanel>
                                    </DataTemplate>
                                </ContentControl.Resources>
                            </ContentControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{lex:Loc Memo}" SortMemberPath="Memo" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Memo}" ToolTip="{Binding Memo}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{lex:Loc Sum}" SortMemberPath="Sum" Width="Auto" IsReadOnly="False">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Resources>
                                    <DataTemplate DataType="{x:Type structure:TransactionIncome}">
                                        <TextBlock Text="{Binding Sum, Converter={StaticResource SumFormat}}" TextAlignment="Right" Foreground="{Binding Sum, Converter={StaticResource SumToBrush}, ConverterParameter={x:Type structure:TransactionIncome }}" />
                                    </DataTemplate>
                                    <DataTemplate DataType="{x:Type native:Transfer}">
                                        <TextBlock Text="{Binding Sum, Converter={StaticResource SumFormat}}" TextAlignment="Right" Foreground="{Binding Sum, Converter={StaticResource SumToBrush}, ConverterParameter={x:Type native:Transfer }}" />
                                    </DataTemplate>
                                </ContentControl.Resources>
                            </ContentControl>
                            <!-- todo: Maybe there is a better solution to the ConverterParameter problem -->
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="{lex:Loc Cleared}" SortMemberPath="Cleared" Width="Auto" IsReadOnly="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding Cleared, Mode=TwoWay}" HorizontalAlignment="Center">
                                <!-- todo: Find out how to change the color of the checkmark
                                <CheckBox.Style>
                                    <Style TargetType="{x:Type CheckBox}" BasedOn="{DynamicResource MetroCheckBox}">
                                        <Setter Property="Foreground" Value="DarkOrange"></Setter>
                                    </Style>
                                </CheckBox.Style> -->
                            </CheckBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <!-- 
                    todo: (Payee, resolve problem with German Translation)
                 -->
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</controls:MetroWindow>
